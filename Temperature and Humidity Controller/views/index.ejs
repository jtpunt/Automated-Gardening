<% include ./partials/header %>

<script type='text/javascript'>
		
	document.addEventListener('DOMContentLoaded', function(event){
		let url = 'http://192.168.254.210:5001/',
			contents = document.getElementById("contents");
			
		fetch(url)
		.then(response => response.json())
		.then(data => { 
			data.forEach(function(sensor){
				let tempId = "temp" + sensor['gpio'] + sensor['_id'],
					humidId = "humid"  + sensor['gpio'] + sensor['_id'];
				if(sensor['isValid']){
					console.log("Redrawing gauges");
					drawGauge(sensor.temperature * 9/5 + 32, 0, tempId);
					drawGauge(sensor.humidity, 1, humidId);

				}else{
					console.log("Is not valid");
					drawGauge("0", 0, tempId);
					drawGauge("0", 1, humidId);
				}
				console.log(sensor);	
			});
		})
		.catch(error => {
			console.log(error);
		})
	})	
</script>
<body>
	<div id="load"></div>
	<div class="container" style='  margin: auto;
  width: 75%;
  border: 3px solid green;'>
		<h3 style='text-align: center'>CURRENT CONDITIONS</h3>
		<% 
			var lastDeviceName
			sensors.forEach(function(sensor, i){ %>
		<%  sensor.deviceName;%>
			<div class="row">
			<% console.log("EJS" + lastDeviceName); 
				console.log(sensor.deviceName);
				if(i > 0 && lastDeviceName === sensor.deviceName){
					console.log("lastDeviceName === sensor.deviceName")
				}
				
			%>
				<h3 style='text-align: center'><%=sensor.deviceName%></h3>
				<div class="col-sm-6" id="<%=sensor.tempId%>" align="center"></div>
				<div class="col-sm-6" id="<%=sensor.humidId%>" align="center"></div>
			</div>
			<script type='text/javascript'>
				// set the gauges initially to 0
				drawGauge("0", 0, "<%=sensor.tempId%>");
				drawGauge("0", 1, "<%=sensor.humidId%>")
			</script>
		<% 
		}); %>
	</div>
</body>
<% include ./partials/footer %>