<script type="text/javascript">

    function relaySelectFn(event, waterDetailsId) {
        let waterDetailsContainer = document.getElementById("waterDetailsContainer");
        let relayServerSelect = document.getElementById("relayServerSelect");
        console.log(event);
        if(waterDetailsId){
            // add divs to get water pump info - relayId, container size, # of lines
            let waterDetailsEle = document.getElementById(waterDetailsId);
            waterDetailsContainer.hidden = false;
            waterDetailsEle.hidden = false;
            console.log(waterDetailsEle);
            console.log(waterDetailsId);
        }else{
            // remove divs
            // need to find all divs for each water pump we are trying to get information on from the user and see if all are hidden, then we will make their parent container 'waterDetailsContainer' hidden,
            // otherwise, we need to hide just the water details that's associated with the relay server that was selected
            //console.log(waterDetailsContainer);
            console.log(relayServerSelect);
            console.log(relayServerSelect.options);
            waterDetailsContainer.hidden = true;
            console.log("Empty string?");
        }
    }
</script>
<div class="collapse" id="collapseNew">
    <div class="well" style="border-left: 5px solid #00C851;">
        <!--If the user is logged in, show the new schedule form-->
        <h4>Add your room details <span class="glyphicon glyphicon glyphicon-pencil" aria-hidden="true"></span></h4>
        <form id="add-comment-form" action="/room" method="POST">
            <hr style="border: 1px solid black;">
            <div class="form-group row">
                <label class="col-sm-6 col-form-label" for="roomName">Room Name</label>
            	<input class="col-sm-20" type="text" id="id" name="roomName" required>
            </div>
            <hr style="border: 1px solid black;">
            <div class="form-group row">
                <label class="col-sm-6 col-form-label" for="roomType">Room Type</label>
                <select class="col-sm-20" name="roomType">
                    <option value="-1" selected="selected" disabled>Select Your Room Type</option>
                    <option value="Vegetative and Flowering">Vegetative and Flowering</option>
                    <option value="Vegetative">Vegetative</option>
                    <option value="Flowering">Flowering</option>
                </select>
            </div>
            <hr style="border: 1px solid black;">
            <% 
                for(const deviceNameKey in availableDevicesObj){
                    /* Remove spaces from device name so that the bootstrap collapse class will work correctly  */
                    let deviceNameStr = deviceNameKey.replace(/\s/g,''); 

                    if(deviceNameKey === "Relay Server"){
                %>
                    <div class="form-group row">
                        <label class="col-sm-6 col-form-label" for="roomDeviceIds"><%=deviceNameKey%></label>
                        <select onchange="relaySelectFn(this, this.value)" id="relayServerSelect" class="col-sm-20" name="roomDeviceIds" multiple="true">
                            <option value="-1" selected="selected" disabled>Select Your <%=deviceNameKey%></option>
                            <% availableDevicesObj[deviceNameKey].forEach(function(device){ 
                            %>
                                <option value="<%=device['_id']%>"><%=device['deviceName']%></option>
                            <% }); %>
                        </select>
                    </div>
                    <hr style="border: 1px solid black;">
                    <div id="waterDetailsContainer">
                    <% 
                        if(availableWaterPumps.length > 0) { 
                            availableWaterPumps.forEach(function(waterPump){
                            let relayName = "";
                            availableDevicesObj[deviceNameKey].forEach(function(device){ 
                                if(device['_id'].toString() === waterPump['relayId'].toString()){
                                    console.log("Ejs Found Device: " + device);
                                    relayName = device['deviceName'];
                                }
                            });
                            
                        %>
                        <div id="<%=waterPump['relayId']%>" hidden>

                            <div class="form-group row">
                                <label class="col-sm-6 col-form-label" for="roomWaterDetails[relayId]">Water Pump Details for <%=relayName%></label>
                                <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[relayId]" value="<%=waterPump['relayId']%>" required readonly hidden>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-6 col-form-label" for="roomWaterDetails[containerSize]">Container Size</label>
                                <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[containerSize]">
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-6 col-form-label" for="roomWaterDetails[numOfLines]">Number of Water Lines</label>
                                <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[numOfLines]">
                            </div>
                            <hr style="border: 1px solid black;">
                        </div>
                        <%

                            }) 
                        %>
                    <% 
                        }
                    %>
                    </div>

                <%
                    } else {
                %>
                    <div class="form-group row">
                        <label class="col-sm-6 col-form-label" for="roomDeviceIds"><%=deviceNameKey%></label>
                        <select id="roomDeviceIds" class="col-sm-20" name="roomDeviceIds" multiple="true">
                            <option value="-1" selected="selected" disabled>Select Your <%=deviceNameKey%></option>
                            <% availableDevicesObj[deviceNameKey].forEach(function(device){ 
                            %>
                                <option value="<%=device['_id']%>"><%=device['deviceName']%></option>
                            <% }); %>
                        </select>
                    </div>
                    <hr style="border: 1px solid black;">
                <%  
                    }   
                }
            %>  
        
            <div class="form-group row">
                <button class="btn btn-success btn-sm">Add Room <i class="fa fa-calendar" aria-hidden="true"></i></button>
            </div>
        </form>
    </div>
</div>

<!--Collapse Add a schedule form END-->