<!--If the user is logged in, show the new schedule form-->
<h4>Add your room details <span class="glyphicon glyphicon glyphicon-pencil" aria-hidden="true"></span></h4>
<form id="add-comment-form" action="/room" method="POST">
    <fieldset id="roomDetails">
        <legend>Room Details</legend>
        <div class="form-group row">
            <label class="col-sm-6 col-form-label" for="roomName">Room Name</label>
        	<input class="col-sm-20" type="text" id="id" name="roomName" required>
        </div>
        <div class="form-group row">
            <label class="col-sm-6 col-form-label" for="roomType">Room Type</label>
            <select class="col-sm-20" name="roomType" required>
                <option value="-1" selected="selected" disabled>Select Your Room Type</option>
                <option value="Vegetative and Flowering">Vegetative and Flowering</option>
                <option value="Vegetative">Vegetative</option>
                <option value="Flowering">Flowering</option>
            </select>
        </div>
        <div class="form-group row">
            <label class="col-sm-6 col-form-label" for="roomGrowSystem">Room Grow System</label>
            <select class="col-sm-20" name="roomGrowSystem" required>
                <option value="-1" selected="selected" disabled>Select Your Room's Grow System</option>
                <option value="Soil">Soil</option>
                <option value="Ebb and Flow">Ebb and Flow</option>
            </select>
        </div>
    </fieldset>
    <fieldset id="roomDeviceDetails" hidden>
        <legend>Room Device Details</legend>
    <% 
        let extraFieldSets = 0;
        for(const deviceNameKey in availableDevicesObj){
            /* Remove spaces from device name so that the bootstrap collapse class will work correctly  */
            let deviceNameStr = deviceNameKey.replace(/\s/g,''); 
            /* Relay Server is the only device type that's required to create a room
            */
            if(deviceNameKey === "Relay Server"){ 
        %>
        
            <div class="form-group row">
                <label class="col-sm-6 col-form-label" for="roomDeviceIds"><%=deviceNameKey%></label>
                <select onchange="relaySelectFn(this)" id="relayServerSelect" class="col-sm-20" name="roomDeviceIds" multiple="true" required>
                    <option value="-1" selected="selected" disabled>Select Your <%=deviceNameKey%></option>
                    <% availableDevicesObj[deviceNameKey].forEach(function(device){ 
                    %>
                        <option value="<%=device['_id']%>"><%=device['deviceName']%></option>
                    <% }); %>
                </select>
            </div>

        <%
            } else {
        %>
            <div class="form-group row">
                <label class="col-sm-6 col-form-label" for="roomDeviceIds"><%=deviceNameKey%></label>
                <select id="roomDeviceIds" class="col-sm-20" name="roomDeviceIds" multiple="true">
                    <option value="-1" selected="selected" disabled>Select Your <%=deviceNameKey%></option>
                    <% availableDevicesObj[deviceNameKey].forEach(function(device){ 
                    %>
                        <option value="<%=device['_id']%>"><%=device['deviceName']%></option>
                    <% }); %>
                </select>
            </div>
        <%  
            }   
        }
    %>  
    </fieldset>
    <fieldset id="waterDetailsContainer" hidden>
        <legend>Water Pump Details</legend>
        
        <% 
            let deviceNameKey = "Relay Server"
            extraFieldSets++;
            if(deviceNameKey in availableDevicesObj && availableWaterPumps.length > 0) { 
                
                availableWaterPumps.forEach(function(waterPump){
                    let relayName = "";
                    availableDevicesObj[deviceNameKey].forEach(function(device){ 
                        if(device['_id'].toString() === waterPump['relayId'].toString()){
                            console.log('GPIO' + waterPump['gpio']);
                            relayName = device['deviceName'];
                        }
                    });
                
            %>
            <div id="<%=waterPump['relayId']%>" class="<%=waterPump['relayId']%>" hidden>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[relayId]">Water Pump Details for <%=relayName%> - GPIO - <%=waterPump['gpio']%></label>
                    <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[relayId]" value="<%=waterPump['relayId']%>" required readonly hidden disabled="true">
                </div>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[relaySettingsId]"></label>
                    <input class="col-sm-20" type="text" id="relaySettingsId" name="roomWaterDetails[relaySettingsId]" value="<%=waterPump['_id']%>" required readonly hidden disabled="true">
                </div>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[pumpWaterFlowRate]">Water Pump's Water Flow Rate (GPH)</label>
                    <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[pumpWaterFlowRate]" disabled="true">
                </div>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[manifoldPortWaterFlowRate]">Manifold Port Water Flow Rate (GPH)</label>
                    <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[manifoldPortWaterFlowRate]" disabled="true">
                </div>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[containerSize]">Container Size (gallons)</label>
                    <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[containerSize]" disabled="true">
                </div>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[numOfLines]">Number of Water Lines</label>
                    <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[numOfWaterLines]" disabled="true">
                </div>
                <div class="form-group row">
                    <label class="col-sm-6 col-form-label" for="roomWaterDetails[numOfLinesUsed]">Number of Water Lines in Use</label>
                    <input class="col-sm-20" type="text" id="relayId" name="roomWaterDetails[numOfWaterLinesUsed]" disabled="true">
                </div>
            </div>
            <%

                }) 
            }
        %>
    </fieldset>
    <fieldset id="reviewFieldset" hidden>
        <legend>
            <i class="fa fa-fw fa-glasses"></i>
            Review your new rooms details
        </legend>
    </fieldset>
    <div style="overflow:auto;">
        <div style="float:right;">
            <button class="btn btn-success btn-sm" type="button" id="prevBtn" onclick="handleMultiStepForm(this, -1)" style="display: none">Previous</button>
            <button class="btn btn-success btn-sm" type="button" id="nextBtn" onclick="handleMultiStepForm(this, 1)">Next</button>
            <button class="btn btn-success btn-sm" id="submitBtn" style="display: none;">Submit <i class="fa fa-calendar" aria-hidden="true" ></i></button>
        </div>
    </div>
        <!-- Circles which indicates the steps of the form: -->
    <div style="text-align:center;margin-top:40px;">
        <span id="step0" class="step active"></span>
        <span id="step1" class="step"></span>
        <% 
            for(let i = 0; i < extraFieldSets; i++){
        %>
        <span id="step<%=i + 2%>" class="step"></span>
        <%

            }
        %>
        <span id="step<%=2+extraFieldSets%>" class="step"></span>     
    </div>
</form>

<!--Collapse Add a schedule form END-->