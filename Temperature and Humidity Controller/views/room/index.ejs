<% include ../partials/header %>
<div class="container">
<div class="row" style="margin: auto;
    width: 100%;
    padding: 10px;">
	<div class="col-md-12">
		<h2>My Rooms</h2>
		<!-- Show Journals -->

		<div class="well col-md-12">
			<!--Setting up the add new schedule button that is used for collapsing-->
	        <div class="text-right">
	            <a class="btn btn-success pull-right" role="button" data-toggle="collapse" href="#collapse" aria-expanded="false" aria-controls="collapse">
	            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Show Rooms</a>
	        </div>
	        <!--Schedule section-->
	    	<div class="text-left">
	        	<h4><strong>Room Example</strong></h4>
	        	<strong>Room Details For Example <i class="fa fa-calendar" aria-hidden="true"></i></strong>
	    	</div>
        	<div class="collapse" id="collapse">
        		<div class="rTable">
					<div class="rTableRow">
						<div class="rTableHead"><span style="font-weight: bold;">Room Name</span></div>
						<!-- Room Name to be added in at a later point, to easily include all devices that are in that room to our 	    journal					
							<div class="rTableHead"><span style="font-weight: bold;">Room Name</div> 
						-->
				         <% 
			                for(const deviceNameKey in deviceObj){
			                    /* Remove spaces from device name so that the bootstrap collapse class will work correctly  */
			                    let deviceNameStr = deviceNameKey.replace(/\s/g,'');
		                %>
		                	<div class="rTableHead"><span style="font-weight: bold;"><%=deviceNameKey%></div>
		                <%
		                	}
		                %>	
					</div>
					<!-- Do we have any rooms set up? -->
					<%
						if(rooms){
							rooms.forEach(function(room){
					%>
						<div class="rTableRow">
							<div class="rTableCell"><%=room['roomName']%></div>
						<% 
			                for(const deviceNameKey in deviceObj){
			                	let deviceMatches = []
			                	deviceObj[deviceNameKey].forEach(function(device){

			                		if(room['roomDeviceIds'].includes(device['_id'])){
			                			console.log("EJS: Room device match found");
			                			deviceMatches.push(device['deviceName']);
			                		}
			                	});
			            %>

							<div class="rTableCell"><%=deviceMatches%></div>

						<%  
							}  
						%>	
							<a class="btn btn-warning" href="/room/<%=room['_id']%>/edit" style="float:left;margin-left: 2.5%">Edit</a>
					        <form action="/room/<%=room['_id']%>/?_method=DELETE" method="POST" class="delete-form" style="float:left;margin-left: 2.5%">
					            <button class="btn btn-danger">Delete</button>
					        </form>
				    	</div>
					<%
							})
						}
					%>
					<!--Setting up the add new room button that is used for collapsing-->
			        <div class="text-right">
			            <a class="btn btn-success pull-left" role="button" data-toggle="collapse" href="#collapseNew" aria-expanded="false" aria-controls="collapseNew">
			            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add New Rooms</a>
			        </div>
				</div>
        	</div>
        	<!--Collapse Add a schedule form START-->
			<% include ./new %>
	        <!--Collapse Add a schedule form END-->
		</div>

	</div>
</div>
</div>
<% include ../partials/footer %>