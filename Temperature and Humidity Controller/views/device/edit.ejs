<% include ../partials/header %>
<script type="text/javascript">
    function deleteEle(e){
        console.log("event called!", e);
        console.log(e.parentNode);
        var form_group = e.parentNode;
        form_group.parentNode.removeChild(form_group);
    }
    function getSelect(gpio){
        var accepted_gpios = [2,3,4,5,6,12,13,16,17,18,19,20,21,22,23,24,25,26,27];
        var form_group = document.createElement("div");
        var label      = document.createElement("label");
        var select     = document.createElement("select");
        var option     = document.createElement("option");
        
        var delBtn     = document.createElement("button");

        form_group.className = "form-group";
        label.htmlFor        = "gpio";
        label.innerText      = "GPIO #";
        select.name          = "gpio";
        delBtn.className     = "btn btn-warning";
        delBtn.innerText     = "Delete";

        option.value = -1;
        option.disabled;
        option.innerText = "Select Your GPIO Pin #:";
        
        form_group.appendChild(label);
        form_group.appendChild(select);
        form_group.appendChild(delBtn);
        select.appendChild(option);
        
        delBtn.onclick = function(e){
            form_group.parentNode.removeChild(form_group);
        }
        accepted_gpios.forEach(function(myGpio){
           var option = document.createElement("option"); 
           option.value = myGpio;
           option.innerText = myGpio;
           if(myGpio === gpio){
               option.selected = true;
           }
           select.appendChild(option);
        });
        return form_group;
    }
    document.onreadystatechange = () => {
        
        var addGpioBtn = document.getElementById("addGpioBtn");
        addGpioBtn.onclick = function(e){
            console.log("Hello!\n");
            var input = document.createElement("input");
            console.log(addGpioBtn);
            addGpioBtn.parentNode.insertBefore(getSelect(2), addGpioBtn);
        }; 
        
    }
</script>
<div class="container">
    <div class="row">
        <h1 style="text-align: center;">Edit <%=device.deviceType%></h1>
        <div style="width: 30%; margin:25px auto;">
            <form action="/device/<%=device._id%>/?_method=PUT" method="post">
               <div class="form-group">
                    <label for="local_ip">Local IP</label>
                    <input class="form-control" type="text" id="local_ip" name="local_ip" value="<%=device.local_ip%>" maxlength="30" required>
                </div>
                <div class="form-group">
                    <label for="deviceName">Device Name</label>
                    <input class="form-control" type="text" id="deviceName" name="deviceName" value="<%=device.deviceName%>" maxlength="30" required>
                </div>
                <% 
                if(device['gpio'] && device['deviceType'] !== "Camera"){    
                    device['gpio'].forEach(function(myGpio){ console.log(myGpio) %>
                    <div class="form-group">
                        <label for="gpio">GPIO #</label>      
        				<select name="gpio">
                    		<option value="-1" selected="selected" disabled>Select Your GPIO Pin #:</option>
        					<option value="2" <% if (myGpio == 2) { %>selected="selected"<% } %> >2</option>
        					<option value="3" <% if (myGpio == 3) { %>selected="selected"<% } %>>3</option>
        					<option value="4" <% if (myGpio == 4) { %>selected="selected"<% } %>>4</option>
                            <option value="5" <% if (myGpio == 5) { %>selected="selected"<% } %>>5</option>
                            <option value="6" <% if (myGpio == 6) { %>selected="selected"<% } %>>6</option>
                            <option value="12" <% if (myGpio == 12) { %>selected="selected"<% } %>>12</option>
                            <option value="13" <% if (myGpio == 13) { %>selected="selected"<% } %>>13</option>
                            <option value="16" <% if (myGpio == 16) { %>selected="selected"<% } %>>16</option>
                            <option value="17" <% if (myGpio == 17) { %>selected="selected"<% } %>>17</option>
                            <option value="18" <% if (myGpio == 18) { %>selected="selected"<% } %>>18</option>
                            <option value="19" <% if (myGpio == 19) { %>selected="selected"<% } %>>19</option>
                            <option value="20" <% if (myGpio == 20) { %>selected="selected"<% } %>>20</option>
                            <option value="21" <% if (myGpio == 21) { %>selected="selected"<% } %>>21</option>
                            <option value="22" <% if (myGpio == 22) { %>selected="selected"<% } %>>22</option>
                            <option value="23" <% if (myGpio == 23) { %>selected="selected"<% } %>>23</option>
                            <option value="24" <% if (myGpio == 24) { %>selected="selected"<% } %>>24</option>
                            <option value="25" <% if (myGpio == 25) { %>selected="selected"<% } %>>25</option>
                            <option value="26" <% if (myGpio == 26) { %>selected="selected"<% } %>>26</option>
                            <option value="27" <% if (myGpio == 27) { %>selected="selected"<% } %>>27</option>
        				</select>
        				<button class="btn btn-warning" onclick="deleteEle(this)" type="button">Delete</button>
    			    </div>
                    <button id="addGpioBtn" type="button">Add GPIO</button>
                <% });
                }
                %>
                <% if(device['deviceType'] === "Camera"){ %>
                    <div class="form-group">
                        <label for="cameraWidth">Camera Width</label>
                        <input class="form-control" type="text" id="cameraWidth" name="cameraWidth" value="<%=cameraSettings.width%>" maxlength="5" required>
                    </div>
                    <div class="form-group">
                        <label for="cameraWidth">Camera Height</label>
                        <input class="form-control" type="text" id="cameraHeight" name="cameraHeight" value="<%=cameraSettings.height%>" maxlength="5" required>
                    </div>
                    <div class="form-group">
                        <label for="rotation">Camera Rotation</label>      
                        <select name="rotation">
                            <option value="0">0</option>
                            <option value="90">90</option>
                            <option value="180">180</option>
                            <option value="240">240</option>
                        </select>
                    </div>
                <% } %>
                <div class="form-group">
                    <button class="btn btn-lg btn-primary btn-block">Submit!</button>
                </div>
            </form>
            <a href="/device">Go Back</a>
        </div>
    </div>
</div>
<% include ../partials/footer %>