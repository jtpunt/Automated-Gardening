<% 
	if(device['local_ip'] in schedules) { 
		schedules[device['local_ip']].forEach(function(schedule){
%>
<tbody>
	<tr>
<% 
    /* 
     * Find additional Relay Settings for the current device so we use those settings to show 
     * what each GPIO turns on/off (water pump, light, ac unit).
     *
     * if no matches are found, the device's GPIO is used by default
     */

        let matchFound = false;
        relaySettings.forEach(function(relaySetting){ 
            if(relaySetting['relayId'].toString() === device['_id'].toString() &&
               relaySetting['gpio'] === schedule['device']['gpio']
            ){
                matchFound = true;
%>
    		<th scope="row"><%=relaySetting['relayType']%></th>
<%
            }
        });
        if(matchFound === false){
%>
    		<th><%=schedule['device']['gpio']%></th>
<%
		}

%>
    		<td><%=schedule['schedule']['hour']%>:<%=schedule['schedule']['minute']%>:<%=schedule['schedule']['second']%></td>
			<% 
				if(schedule['schedule']['dayOfWeek'] && schedule['schedule']['dayOfWeek'].length) { 
					schedule['schedule']['dayOfWeek'] = schedule['schedule']['dayOfWeek'].map(function(day){
						switch(day){
							case 0: return "S ";
							case 1: return "M ";
							case 2: return "T";
							case 3: return "W ";
							case 4: return "Th ";
							case 5: return "F ";
							case 6: return "S ";
						}
					})
			%>
				<td><%=schedule['schedule']['dayOfWeek']%></td>
			<% 
				}else { %>
				<td>N/A</td>
			<% 
				} 
			%>
			<% 
				if(schedule['schedule']['month'] && schedule['schedule']['date'] && schedule['schedule']['year']) { 
			%>
				<td><%=schedule['schedule']['month']%>/<%=schedule['schedule']['date']%>/<%=schedule['schedule']['year']%></td>
			<% 
				} else { 
			%>
				<td>N/A</td>
			<% 
				} 
			%>
			<% 
				if(schedule['device']['desired_state'] === true){ 
			%>
				<td>on</td>
			<% 
				}else if(schedule['device']['desired_state'] === false) { 
			%>
				<td>Off</td>
			<% 
				}else { 
			%>
				<td>Unkown</td>
			<% 
				} 
			%>
			<td>
				<table>
					<tbody>
						<tr>
							<td>
								<a class="btn btn-warning" href="/schedule/<%=schedule['_id']%>/edit">Edit</a>
							</td>
							<td>
						        <form action="/schedule/<%=schedule['_id']%>/local_ip/<%=device['local_ip']%>/?_method=DELETE" method="POST" class="delete-form">
						            <button class="btn btn-danger">Delete</button>
						        </form>
						    </td>
						</tr>
					</tbody>
				</table>
		
			</td>
			
    	</tr>
	</tbody>
	<% 
		})
	} else { 
	%>
		<div>No schedules found!</div>
	<% } %>