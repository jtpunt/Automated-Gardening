<% include ../partials/header %>
<script type="text/javascript">
	function myFunction(id) {
		console.log(id, this);
		var x = document.getElementById(id);
		if (x.style.display === "none") {
			x.style.display = "block";
		} else {
			x.style.display = "none";
		}
	} 
	function selectCheckbox(id){
		console.log(id);
		var x = document.getElementById(id);
		console.log(x);
		if(x.checked){
			// myEle.setAttribute("style", "background: #2AD705;color: #ffffff;");
			x.classList.remove("selectedCheckbox");
			x.checked = false;
		}else{
			// context.nextElementSibling.className = " deselectCheckbox"
			x.className += " selectedCheckbox";
			x.checked = true;
		}
	}
</script>
<style>
.weekDays-selector input {
  display: none!important;
}

.selectedCheckbox {
  background: #2AD705 !important;
  color: #ffffff !important;
}
.deselectedCheckbox {
  display: inline-block;
  border-radius: 6px;
  background: #dddddd;
  height: 40px;
  width: 30px;
  margin-right: 3px;
  line-height: 40px;
  text-align: center;
  cursor: pointer;
}
</style>
<body>
	<div class="container">
	<div class="row" style="    margin: auto;
	    width: 75%;
	    padding: 10px;">
		<div class="col-md-9">
			<h2>My Schedules</h2>
			<!-- Show schedules for each relay device -->
			<% devices.forEach(function(device){ let ipStr = device['local_ip'].replace(/\./g,''); %>
			<div class="well">
				<!--Setting up the add new schedule button that is used for collapsing-->
		        <div class="text-right">
		            <a class="btn btn-success pull-right" role="button" data-toggle="collapse" href="#collapse<%=ipStr%>" aria-expanded="false" aria-controls="collapse<%=ipStr%>">
		            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Show Schedules</a>
		        </div>
		        <!--Schedule section-->
		        <h4><strong>Schedules for <%=device["local_ip"]%> <i class="fa fa-calendar" aria-hidden="true"></i></strong></h4>
	        	<div class="collapse" id="collapse<%=ipStr%>">
	        		<div class="rTable">
						<div class="rTableRow">
							<div class="rTableHead"><strong>IP Address</strong></div>
							<div class="rTableHead"><span style="font-weight: bold;">Pin #</span></div>
							<div class="rTableHead"><span style="font-weight: bold;">Time</div>
						</div>
						<!-- Do we have any schedules set up for the current device? -->
						<% if(device['local_ip'] in schedules) { 
							schedules[device['local_ip']].forEach(function(schedule){
						%>
						<div class="rTableRow">
							<div class="rTableCell"><%=schedule['device']['local_ip']%></div>
							<div class="rTableCell"><%=schedule['device']['gpio']%></div>
							<div class="rTableCell"><%=schedule['schedule']['hour']%>:<%=schedule['schedule']['minute']%>:<%=schedule['schedule']['second']%></div>
							<div>
								<a class="btn btn-warning" href="/schedule/<%=schedule['_id']%>/edit" style="float:left;margin-left: 2.5%">Edit</a>
				                <form action="/schedule/<%=schedule['_id']%>/local_ip/<%=device['local_ip']%>/?_method=DELETE" method="POST" class="delete-form" style="float:left;margin-left: 2.5%">
				                    <button class="btn btn-danger">Delete</button>
				                </form>
				            </div>
						</div>
						<% })} else{ %>
							<div>No schedules found!</div>
						<% } %>
						<br>
						<!--Setting up the add new schedule button that is used for collapsing-->
				        <div class="text-right">
				            <a class="btn btn-success pull-left" role="button" data-toggle="collapse" href="#collapse<%=ipStr%>New" aria-expanded="false" aria-controls="collapse<%=ipStr%>New">
				            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add New Schedule</a>
				        </div>
					</div>
	        	</div>
		        <!--Collapse Add a schedule form START-->
		        <div class="collapse" id="collapse<%=ipStr%>New">
		            <div class="well" style="border-left: 5px solid #00C851;">
		                <!--If the user is logged in, show the new schedule form-->
		                <h4>Add your new schedule <span class="glyphicon glyphicon glyphicon-pencil" aria-hidden="true"></span></h4>
		                <form id="add-comment-form" action="/schedule" method="POST">
		                    <div class="form-group">
		                    	<input type="text" id="local_ip" name="device[local_ip]" value="<%=device['local_ip']%>" hidden required>
		                    </div>
		                    <div class="form-group">
		                    	<input type="text" id="id" name="device[id]" value="<%=device['_id']%>" hidden required>
		                    </div>
		                    <div class="form-group">
		                    	<label for="gpio">Set GPIO: </label>
	  							<select name="device[gpio]">
		                    		<option value="-1" selected="selected" disabled>Select Your GPIO:</option>
									<% device['gpio'].forEach(function(myGpio){%>
										<option value=<%=myGpio%>><%=myGpio%></option>
									<% }) %>
	  							</select>
	  						</div>
	  						<div class="form-group">
	  							<label for="time">Set Time: </label>
								<input type="time" id="time" name="schedule[time]" value="13:30:00" step="1" required>
		                    </div>
		                    <div class="form-group">
		                    	<label for="DateCheckBox">Set Date?</label>
		                        <input type="checkbox" name="DateCheckBox" onclick="myFunction('<%=ipStr%>Date')" unchecked>
		                    </div>
		                    <div class="form-group">
		                    	<label for="DayOfWeekCheckBox">Set Day of Week?</label>
		                        <input type="checkbox" name="DayOfWeekCheckBox" onclick="myFunction('<%=ipStr%>DayOfWeek')" unchecked>
		                    </div>
		                    <div class="form-group" id="<%=ipStr%>Date" style="display:none">
		                    	<label for="date">Set Date: </label>
		                    	<input type="date" name="schedule[date]">
		                    </div>
		                    <div class="form-group" id="<%=ipStr%>DayOfWeek" style="display:none">
		                    	<label for="weekDays-selector">Select day of week: </label>
		                    	<div class="weekDays-selector" id="weekDays-selector">
		                    		<label for="<%=ipStr%>weekday-mon" id='<%=ipStr%>mon' class="deselectedCheckbox">M</label>
									<input type="checkbox" id="<%=ipStr%>weekday-mon" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>mon')" class="weekday" value="0"/>
									
									<label for="<%=ipStr%>weekday-tue" id='<%=ipStr%>tue' class="deselectedCheckbox">T</label>
									<input type="checkbox" id="<%=ipStr%>weekday-tue" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>tue')" class="weekday" value="1"/>
									
									<label for="<%=ipStr%>weekday-wed" id='<%=ipStr%>wed' class="deselectedCheckbox">W</label>
									<input type="checkbox" id="<%=ipStr%>weekday-wed" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>wed')" class="weekday" value="2"/>
							
									<label for="<%=ipStr%>weekday-thu" id='<%=ipStr%>thu' class="deselectedCheckbox">T</label>
									<input type="checkbox" id="<%=ipStr%>weekday-thu" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>thu')" class="weekday" value="3"/>
									
									<label for="<%=ipStr%>weekday-fri" id='<%=ipStr%>fri' class="deselectedCheckbox">F</label>
									<input type="checkbox" id="<%=ipStr%>weekday-fri" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>fri')" class="weekday" value="4"/>
									
									<label for="<%=ipStr%>weekday-sat" id='<%=ipStr%>sat' class="deselectedCheckbox">S</label>
									<input type="checkbox" id="<%=ipStr%>weekday-sat" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>sat')" class="weekday" value="5"/>
									
									<label for="<%=ipStr%>weekday-sun" id='<%=ipStr%>sun' class="deselectedCheckbox">S</label>
									<input type="checkbox" id="<%=ipStr%>weekday-sun" name="schedule[dayOfWeek]" onclick="selectCheckbox('<%=ipStr%>sun')" class="weekday" value="6"/>
								</div>
		                    </div>
		                    <div class="form-group">
		                        <button class="btn btn-success btn-sm">Add Schedule <i class="fa fa-calendar" aria-hidden="true"></i></button>
		                    </div>
		                </form>
		            </div>
		        </div>
		        <!--Collapse Add a schedule form END-->
			</div>
			<% }); %>
		</div>
	</div>
	</div>
</body>
<% include ../partials/footer %>