<% include ./partials/header %>

<script type='text/javascript'>
		
	document.addEventListener('DOMContentLoaded', function(event){
		let url = 'http://192.168.254.210:5000/',
			contents = document.getElementById("contents");
			
		fetch(url)
		.then(response => response.json())
		.then(data => { 
			data.forEach(function(sensor){
				let tempId = "temp" + sensor['gpio'] + sensor['_id'],
					humidId = "humid"  + sensor['gpio'] + sensor['_id'];
				if(sensor['isValid']){
					console.log("Redrawing gauges");
					drawGauge(sensor.temperature * 9/5 + 32, 0, tempId);
					drawGauge(sensor.humidity, 1, humidId);

				}else{
					console.log("Is not valid");
					drawGauge("0", 0, tempId);
					drawGauge("0", 1, humidId);
				}
				console.log(sensor);	
			});
		})
		.catch(error => {
			console.log(error);
		})
	})	
</script>
<div id="load"></div>
<div class="container" id="contents">
	<h3 >CURRENT CONDITIONS</h3>
	<div class="row">
	<% sensors.forEach(function(sensor, i, sensorArr){ %>
		<div class="col-lg-3">
			<div class="card text-center">
			  	<div class="card-header"><small><%=sensor.deviceName%></small>
				    
			  	</div>
			  	<div class="card-body">
					<div id="<%=sensor.tempId%>" align="center"></div>
					<div id="<%=sensor.humidId%>" align="center"></div> 
				</div>
			</div>
		</div>
		<script type='text/javascript'>
			// set the gauges initially to 0
			drawGauge("0", 0, "<%=sensor.tempId%>");
			drawGauge("0", 1, "<%=sensor.humidId%>");
		</script>
	<% 
	}); %>
	</div>
</div>

<% include ./partials/footer %>